<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    $if(title)$
    <title>$title$</title>
    $else$
    <title>Trex Deck</title>
    $endif$

    <!-- Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Spectral:ital,wght@0,400;0,700;1,400;1,700&display=swap" rel="stylesheet">

    <!-- CSS -->
    <link rel="stylesheet" href="/css/solarized.css">
    <link rel="stylesheet" href="/css/trex.css">

    $if(custom-css)$
    <link rel="stylesheet" href="$custom-css$">
    $endif$

    <script type="text/x-mathjax-config">
      MathJax.Hub.Config({
      extensions: ["tex2jax.js"],
      jax: ["input/TeX","output/HTML-CSS"],
      "HTML-CSS": {
      styles: {".MathJax_Preview": {visibility: "hidden"}}
      },
      tex2jax: {inlineMath: [["\[","\]"],["\\\(","\\\)"]]},
      TeX: {extensions: ["AMSmath.js","AMSsymbols.js","/js/xypic.js"]}
      });
    </script>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.3/MathJax.js"></script>
  
  </head>

  <body>
    <div class="slides">
      $for(slides)$
      <section>
	$body$
      </section>
      $endfor$
    </div>
    <script>
      var curIdx = 0;
      var slides = [];
      
      document.addEventListener('DOMContentLoaded', function() {
        slides = document.querySelectorAll('.slides section');
        const qp = new URLSearchParams(window.location.search);
        const slide = parseInt(qp.get("s"));
        if (!isNaN(slide) && slide > 0 && slide < slides.length) {
          curIdx = slide;
        }
        slides[curIdx].classList.add('visible');
      });
      
      document.addEventListener('keydown', function(event) {
        if (event.keyCode === 37) {
          nav(-1);
        } else if (event.keyCode === 39) {
          nav(1);
        }
      });
      
      function nav(dir) {
        const newIdx = curIdx + dir;
        if (newIdx >= 0 && newIdx < slides.length) {
          document.querySelector('.slides section.visible').classList.remove('visible');
          slides[newIdx].classList.add('visible');
	  const url = window.location.pathname + '?s=' + newIdx;
	  history.pushState({slideIndex: newIdx}, '', url); 
          curIdx = newIdx;
        }
      }
    </script>
  </body>
</html>
